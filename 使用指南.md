# QGpT ä½¿ç”¨æŒ‡å—

## ğŸ¯ æ¦‚è¿°

QGpT (Question Generation from Partial Tables) æ˜¯ä¸€å€‹æ”¹å–„è¡¨æ ¼æª¢ç´¢çš„æ¡†æ¶ï¼Œé€šéå¾éƒ¨åˆ†è¡¨æ ¼ç”Ÿæˆåˆæˆå•é¡Œä¾†æå‡é–‹æ”¾åŸŸè¡¨æ ¼æª¢ç´¢çš„æ•ˆæœã€‚æœ¬é …ç›®æä¾›å®Œæ•´çš„è¡¨æ ¼åµŒå…¥å‘é‡ç”Ÿæˆã€æœç´¢æŸ¥è©¢å’Œè©•ä¼°åŠŸèƒ½ã€‚

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

æœ¬ç³»çµ±æ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒçµ„ä»¶ï¼š

1. **èªæ–™åº«åµŒå…¥å‘é‡å»ºç«‹å™¨** (`corpus_embedding_builder.py`)
2. **æœç´¢æŸ¥è©¢ä»‹é¢** (`qgpt_search.py`) 
3. **æŸ¥è©¢è©•ä¼°å™¨** (`query_evaluator.py`)
4. **å…¬ç”¨å·¥å…·å‡½æ•¸** (`utils.py`)
5. **æ¼”ç¤ºç¨‹å¼** (`demo_restructured.py`)

## ğŸ“ æª”æ¡ˆçµæ§‹

```
/Users/yaochungfan/QGpT/
â”œâ”€â”€ corpus_embedding_builder.py # èªæ–™åº«åµŒå…¥å‘é‡å»ºç«‹å™¨
â”œâ”€â”€ qgpt_search.py            # å‘½ä»¤è¡Œæœç´¢ä»‹é¢
â”œâ”€â”€ query_evaluator.py        # æŸ¥è©¢è©•ä¼°å™¨
â”œâ”€â”€ demo_restructured.py      # æ¼”ç¤ºç¨‹å¼
â”œâ”€â”€ example_retrieval.py      # ç¤ºä¾‹æª¢ç´¢è…³æœ¬
â”œâ”€â”€ utils.py                  # å…¬ç”¨å·¥å…·å‡½æ•¸
â”œâ”€â”€ qgpt_*.db                # QGpT å‘é‡è³‡æ–™åº«æª”æ¡ˆ
â”œâ”€â”€ requirements.txt         # ä¾è³´å¥—ä»¶æ¸…å–®
â”œâ”€â”€ ä½¿ç”¨æŒ‡å—.md              # æœ¬æª”æ¡ˆï¼ˆä¸­æ–‡ä½¿ç”¨æŒ‡å—ï¼‰
â”œâ”€â”€ readme.md                # è‹±æ–‡èªªæ˜æ–‡ä»¶
â”œâ”€â”€ CODE_README.md          # ç¨‹å¼ç¢¼èªªæ˜
â””â”€â”€ UPDATED_README.md       # æ¶æ§‹æ›´æ–°èªªæ˜
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒè¨­ç½®

#### å®‰è£ä¾è³´å¥—ä»¶
```bash
pip install -r requirements.txt
```

#### ä¸»è¦ä¾è³´
- `pymilvus[model]>=2.3.0` - Milvus å‘é‡è³‡æ–™åº«å®¢æˆ¶ç«¯
- `numpy>=1.21.0` - æ•¸å€¼é‹ç®—æ”¯æ´

### 2. é‹è¡Œæ¼”ç¤ºç¨‹å¼

```bash
python demo_restructured.py
```
æ­¤æ¼”ç¤ºç¨‹å¼æœƒè‡ªå‹•ï¼š
- åˆ—å‡ºæ‰€æœ‰å¯ç”¨èªæ–™åº«
- å»ºç«‹æ¸¬è©¦ç”¨çš„åµŒå…¥å‘é‡
- åŸ·è¡Œç¯„ä¾‹æœç´¢æŸ¥è©¢
- å±•ç¤ºç³»çµ±åŠŸèƒ½

### 3. å»ºç«‹èªæ–™åº«åµŒå…¥å‘é‡

#### åˆ—å‡ºæ‰€æœ‰å¯ç”¨èªæ–™åº«
```bash
python corpus_embedding_builder.py --list
```

#### ç‚ºå–®ä¸€èªæ–™åº«å»ºç«‹åµŒå…¥å‘é‡
```bash
python corpus_embedding_builder.py Corpora/Table1_mimo_table_length_variation/mimo_ch/1k_token.json
```

#### ç‚ºæ‰€æœ‰èªæ–™åº«å»ºç«‹åµŒå…¥å‘é‡
```bash
python corpus_embedding_builder.py --all
```

#### å¼·åˆ¶é‡å»ºå·²å­˜åœ¨çš„è³‡æ–™åº«
```bash
python corpus_embedding_builder.py --all --force
```

### 4. æœç´¢æŸ¥è©¢

#### åŸºæœ¬æœç´¢ï¼ˆè‡ªå‹•åµæ¸¬è³‡æ–™åº«ï¼‰
```bash
python qgpt_search.py "è²¡å‹™å ±è¡¨"
```

#### æŒ‡å®šåƒæ•¸çš„æœç´¢
```bash
# æŒ‡å®šçµæœæ•¸é‡å’Œæ ¼å¼
python qgpt_search.py "construction project" -n 10 -f json

# ç°¡å–®æ ¼å¼è¼¸å‡º
python qgpt_search.py "å­¸ç”Ÿæˆç¸¾" -f simple

# æŒ‡å®šç‰¹å®šè³‡æ–™åº«
python qgpt_search.py "éŠ€è¡Œåˆ©ç‡" --db qgpt_Table1_mimo_ch.db
```

#### åˆ—å‡ºæ‰€æœ‰å¯ç”¨è³‡æ–™åº«
```bash
python qgpt_search.py --list-dbs
```

### 5. æŸ¥è©¢è©•ä¼°

#### å–®ä¸€æŸ¥è©¢è©•ä¼°
```bash
python query_evaluator.py "è²¡å‹™å ±è¡¨" --db qgpt_Table1_mimo_ch.db
```

#### ä½¿ç”¨æ¸¬è©¦æª”æ¡ˆè©•ä¼°
```bash
python query_evaluator.py --test-file Test_Query_and_GroundTruth_Table/MiMoTable-English_test.json --db qgpt_Table1_mimo_en.db
```

#### æ‰¹æ¬¡è©•ä¼°æ‰€æœ‰æ¸¬è©¦é›†
```bash
python query_evaluator.py --batch-eval
```

## ğŸ“Š æ”¯æ´çš„æœç´¢é¡å‹

- **ä¸­æ–‡æŸ¥è©¢**: "è²¡å‹™å ±è¡¨", "å»ºç¯‰å·¥ç¨‹", "å­¸ç”Ÿæˆç¸¾"
- **è‹±æ–‡æŸ¥è©¢**: "financial statements", "construction project", "student information"
- **æ··åˆæŸ¥è©¢**: æ”¯æ´ä¸­è‹±æ–‡æ··åˆçš„æŸ¥è©¢

## ğŸ›ï¸ å‘½ä»¤è¡Œé¸é …

### qgpt_search.py é¸é …

- `query`: æœç´¢æŸ¥è©¢å­—ç¬¦ä¸² (å¿…é ˆ)
- `-n, --limit`: è¿”å›çµæœæ•¸é‡ (é è¨­: 5)
- `-f, --format`: è¼¸å‡ºæ ¼å¼
  - `detailed`: è©³ç´°æ ¼å¼ (é è¨­)
  - `simple`: ç°¡å–®æ ¼å¼
  - `json`: JSON æ ¼å¼
- `--db`: è³‡æ–™åº«è·¯å¾‘ (è‡ªå‹•åµæ¸¬ qgpt_*.db æª”æ¡ˆ)
- `--collection`: é›†åˆåç¨± (è‡ªå‹•å¾è³‡æ–™åº«åç¨±æ¨å°)

### ä½¿ç”¨ç¯„ä¾‹

```bash
# è©³ç´°æ ¼å¼æœç´¢
python qgpt_search.py "éŠ€è¡Œåˆ©ç‡"

# ç°¡å–®æ ¼å¼ï¼Œé™åˆ¶ 3 å€‹çµæœ
python qgpt_search.py "bank interest" -n 3 -f simple

# JSON æ ¼å¼è¼¸å‡º
python qgpt_search.py "æ•™è‚²è³‡æº" -f json

# æŸ¥çœ‹å¹«åŠ©
python qgpt_search.py --help
```

## ğŸ”§ ç³»çµ±æ¶æ§‹èˆ‡å·¥ä½œæµç¨‹

### è³‡æ–™åº«å‘½åè¦å‰‡

ç³»çµ±æœƒæ ¹æ“šèªæ–™åº«è·¯å¾‘è‡ªå‹•ç”Ÿæˆè³‡æ–™åº«å’Œé›†åˆåç¨±ï¼š

```
èªæ–™åº«è·¯å¾‘ â†’ è³‡æ–™åº«åç¨±
Corpora/Table1_mimo_table_length_variation/mimo_ch/1k_token.json 
â†’ qgpt_Table1_mimo_table_length_variation_mimo_ch.db

å‘é‡é›†åˆåç¨±
Table1_mimo_table_length_variation_mimo_ch 
â†’ embeddings_Table1_mimo_table_length_variation_mimo_ch
```

### è™•ç†æµç¨‹

1. **è³‡æ–™è¼‰å…¥**: å¾ Corpora ç›®éŒ„è¼‰å…¥è¡¨æ ¼ JSON è³‡æ–™
2. **çµæ§‹é©—è­‰**: é©—è­‰èªæ–™åº«è³‡æ–™æ ¼å¼å’Œå®Œæ•´æ€§
3. **æ–‡å­—é è™•ç†**: æ¸…ç†å’Œæ ¼å¼åŒ–è¡¨æ ¼æ–‡å­—
4. **åµŒå…¥ç”Ÿæˆ**: ä½¿ç”¨é è¨“ç·´æ¨¡å‹ç”Ÿæˆ 768 ç¶­å‘é‡
5. **å‘é‡å„²å­˜**: ä½¿ç”¨ Milvus å»ºç«‹å‘é‡ç´¢å¼•å’Œé›†åˆ
6. **èªç¾©æœç´¢**: åŸºæ–¼å‘é‡ç›¸ä¼¼åº¦é€²è¡Œæª¢ç´¢
7. **çµæœè©•ä¼°**: æ”¯æ´èˆ‡ ground truth æ¯”è¼ƒè©•ä¼°

### æ”¯æ´çš„èªæ–™åº«

ç³»çµ±æ”¯æ´ä»¥ä¸‹å¯¦é©—èªæ–™åº«ï¼š
- `Table1_mimo_table_length_variation/` - è¡¨æ ¼é•·åº¦è®ŠåŒ–å¯¦é©—
- `Table3_mimo_en_table_representation/` - è¡¨æ ¼è¡¨ç¤ºæ–¹æ³•å¯¦é©—  
- `Table5_Single_Table_Retrieval/` - å–®è¡¨æª¢ç´¢å¯¦é©—
- `Table6_Multi_Table_Retrieval/` - å¤šè¡¨æª¢ç´¢å¯¦é©—
- `Table7_OTTQA/` - OTTQA è³‡æ–™é›†å¯¦é©—

## ğŸ“ˆ æ•ˆèƒ½æŒ‡æ¨™

- **å‘é‡ç¶­åº¦**: 768 ç¶­ï¼ˆé è¨­ï¼Œå¯èª¿æ•´ï¼‰
- **æœç´¢é€Ÿåº¦**: æ¯«ç§’ç´šéŸ¿æ‡‰
- **ç›¸ä¼¼åº¦ç¯„åœ**: 0.0 - 1.0 (è¶Šé«˜è¶Šç›¸ä¼¼)
- **æ”¯æ´èªè¨€**: ä¸­æ–‡ã€è‹±æ–‡åŠæ··åˆæŸ¥è©¢
- **è³‡æ–™åº«æ ¼å¼**: Milvus å‘é‡è³‡æ–™åº« (.db æª”æ¡ˆ)

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **æ‰¾ä¸åˆ°é›†åˆéŒ¯èª¤**
   ```
   éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°é›†åˆ 'qgpt_table_embeddings'
   ```
   è§£æ±ºæ–¹æ¡ˆ: å…ˆåŸ·è¡Œ `python corpus_embedding_builder.py` å»ºç«‹è³‡æ–™åº«

2. **ç·¨ç¢¼éŒ¯èª¤**
   ç¢ºä¿çµ‚ç«¯æ”¯æ´ UTF-8 ç·¨ç¢¼ï¼Œç‰¹åˆ¥æ˜¯åœ¨ Windows ç³»çµ±ä¸Š

3. **è¨˜æ†¶é«”ä¸è¶³**
   è™•ç†å¤§é‡è³‡æ–™æ™‚å¯èƒ½éœ€è¦æ›´å¤šè¨˜æ†¶é«”ï¼Œè€ƒæ…®åˆ†æ‰¹è™•ç†

### ä¾è³´å•é¡Œ

å¦‚æœé‡åˆ°å¥—ä»¶ç›¸é—œå•é¡Œï¼Œè«‹ç¢ºä¿ï¼š
- Python ç‰ˆæœ¬ >= 3.8
- å·²å®‰è£æ‰€æœ‰å¿…è¦ä¾è³´ï¼š`pip install -r requirements.txt`

## ğŸ“ ç›¸é—œè«–æ–‡

å¦‚æœæ‚¨ä½¿ç”¨äº†é€™å€‹ç³»çµ±ï¼Œè«‹å¼•ç”¨æˆ‘å€‘çš„è«–æ–‡ï¼š

```bibtex
@inproceedings{
liang2025improving,
title={Improving Table Retrieval with Question Generation from Partial Tables},
author={Hsing-Ping Liang and Che-Wei Chang and Yao-Chung Fan},
booktitle={The 4th Table Representation Learning Workshop at ACL 2025},
year={2025},
url={https://openreview.net/forum?id=Q8HOV0UMwA}
}
```

## ğŸ“§ è¯çµ¡æ–¹å¼

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹è¯çµ¡ï¼šcc3374twa@gmail.com

## ï¿½ é€²éšåŠŸèƒ½

### æ‰¹æ¬¡è™•ç†

ç³»çµ±æ”¯æ´æ‰¹æ¬¡å»ºç«‹æ‰€æœ‰èªæ–™åº«çš„åµŒå…¥å‘é‡ï¼š
```bash
# å»ºç«‹æ‰€æœ‰èªæ–™åº«ï¼ˆè·³éå·²å­˜åœ¨çš„ï¼‰
python corpus_embedding_builder.py --all

# å¼·åˆ¶é‡å»ºæ‰€æœ‰èªæ–™åº«
python corpus_embedding_builder.py --all --force
```

### è©•ä¼°åŠŸèƒ½

#### å–®ä¸€æŸ¥è©¢æ¸¬è©¦
```bash
python query_evaluator.py "financial data" --db qgpt_Table5_Single_Table_Retrieval_QGpT.db --limit 5
```

#### æ‰¹æ¬¡è©•ä¼°èˆ‡çµæœå„²å­˜
```bash
# æ‰¹æ¬¡è©•ä¼°ä¸¦å„²å­˜çµæœ
python query_evaluator.py --batch-eval --save

# æŒ‡å®šè©•ä¼°é™åˆ¶æ•¸é‡
python query_evaluator.py --batch-eval --limit 10
```

### æ™ºæ…§è³‡æ–™åº«é¸æ“‡

æœç´¢æ™‚ç³»çµ±æœƒè‡ªå‹•ï¼š
1. åµæ¸¬ç•¶å‰ç›®éŒ„ä¸‹çš„æ‰€æœ‰ .db æª”æ¡ˆ
2. å¦‚æœåªæœ‰ä¸€å€‹è³‡æ–™åº«ï¼Œè‡ªå‹•é¸æ“‡
3. å¦‚æœæœ‰å¤šå€‹è³‡æ–™åº«ï¼Œæä¾›é¸æ“‡æ¸…å–®
4. æ”¯æ´ `--list-dbs` æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è³‡æ–™åº«

## ï¿½ğŸ”„ æ›´æ–°æ—¥èªŒ

- **2025/09/09**: é‡æ§‹ç¨‹å¼ç¢¼æ¶æ§‹ï¼Œæ–°å¢æ¨¡çµ„åŒ–è¨­è¨ˆ
  - æ–°å¢ `query_evaluator.py` æŸ¥è©¢è©•ä¼°åŠŸèƒ½
  - æ–°å¢ `utils.py` å…¬ç”¨å·¥å…·æ¨¡çµ„
  - æ”¹å–„è³‡æ–™åº«å‘½åè¦ç¯„å’Œè‡ªå‹•åµæ¸¬
  - æ–°å¢æ‰¹æ¬¡è™•ç†å’Œè©•ä¼°åŠŸèƒ½
  - æ–°å¢ `demo_restructured.py` æ¼”ç¤ºç¨‹å¼

- **2025/09/08**: ç™¼å¸ƒ Hugging Face è³‡æ–™é›†
  - å…­å€‹æ¸¬è©¦è³‡æ–™é›†ä¸Šç·šï¼šE2E-WTQ, FeTAQA, MMQA, MimoTable, OTTQA
  - æ”¯æ´ recall@k è©•ä¼°

- **åˆå§‹ç‰ˆæœ¬**: å¯¦ç¾åŸºæœ¬çš„è¡¨æ ¼æª¢ç´¢åŠŸèƒ½
  - åŸºç¤åµŒå…¥å‘é‡ç”Ÿæˆ
  - å‘½ä»¤è¡Œæœç´¢ä»‹é¢
  - Milvus å‘é‡è³‡æ–™åº«æ•´åˆ
